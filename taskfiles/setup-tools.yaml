# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  INFO: "source lib/logging.sh; info"
  ERROR: "source lib/logging.sh; error"
  WARN: "source lib/logging.sh; warn"
  DEBUG: "source lib/logging.sh; debug"

tasks:
  fzf:
    silent: true
    desc: "Install fzf and setup keybindings"
    cmds:
      - "{{.INFO}} Configuring fzf keybindings"
      - mkdir -p ~/.fzf/shell
      - "cp $(brew --prefix fzf)/shell/key-bindings.zsh ~/.fzf/shell/key-bindings.zsh"
      - test -f ~/.fzf/shell/key-bindings.zsh || echo config/fzf/key-bindings.zsh >> ~/.fzf/shell/key-bindings.zsh

  kitty:
    silent: false
    desc: "Install kitty and replace kitty.conf"
    cmds:
      - "{{.INFO}} Configuring kitty"
      - mkdir -p ~/.config/kitty
      - gomplate -f config/kitty/kitty.conf.tmpl -o ~/.config/kitty/kitty.conf
      - cp config/kitty/current-theme.conf ~/.config/kitty/current-theme.conf
      - cp config/kitty/xterm-kitty.terminfo ~/.config/kitty/xterm-kitty.terminfo

  starship:
    silent: true
    desc: "Install starship and customize it"
    cmds:
      - "{{.INFO}} Customizing starship"
      - mkdir -p ~/.config/starship
      - "gomplate -f config/starship/starship.toml -o ~/.config/starship/starship.toml"

  vim:
    silent: true
    desc: "Install vim, install vundle, & replace vimrc"
    cmds:
      - "{{.INFO}} Configuring vim"
      - gomplate -f config/vim/.vimrc.tmpl -o ~/.config/vim/vimrc
      - mkdir -p ~/.local/share/vim/bundle
      - test -d ~/.local/share/vim/bundle/vim-maktaba || git clone https://github.com/google/vim-maktaba.git ~/.local/share/vim/bundle/vim-maktaba
      - test -d ~/.local/share/vim/bundle/vim-glaive || git clone https://github.com/google/vim-glaive.git ~/.local/share/vim/bundle/vim-glaive
      - test -d ~/.local/share/vim/bundle/Vundle.vim || git clone https://github.com/VundleVim/Vundle.vim.git ~/.local/share/vim/bundle/Vundle.vim

  zsh:
    silent: true
    desc: "Install zsh and replace zdot files"
    cmds:
      - "{{.INFO}} config zsh"
      - gomplate -f config/.env.tmpl -o .env
      - rsync -u ./config/zsh/.zshrc.d/* ~/.zshrc.d/
